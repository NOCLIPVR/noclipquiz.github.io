<script>
const form = document.getElementById('quizForm');
const quizContainer = document.getElementById('quiz-container');
const nameContainer = document.getElementById('name-container');
const userNameInput = document.getElementById('user-name');
const submitNameBtn = document.getElementById('submit-name-btn');
const submitQuizBtn = document.getElementById('submit-quiz-btn');
const webhookURL = "YOUR_WEBHOOK_URL_HERE"; // Replace with your Discord webhook URL

let isQuizStarted = false;  // Track if quiz has started

// Handle the name submission
submitNameBtn.addEventListener('click', function() {
  const userName = userNameInput.value.trim();

  if (userName === "") {
    alert("Please enter your name.");
    return;
  }

  // If the input is '===++', allow multiple name submissions
  if (userName === '===++') {
    localStorage.setItem('userName', userName);
    alert('You can submit the name as many times as you want!');
    return;  // Do not hide the name input section
  }

  // Regular name submission behavior
  if (!isQuizStarted) {
    localStorage.setItem('userName', userName);
    nameContainer.style.display = 'none';
    quizContainer.style.display = 'block';
    alert(`Welcome, ${userName}! Start the quiz now.`);
    isQuizStarted = true;  // Mark quiz as started
  }
});

// Staff selection logic
const q15Checkboxes = document.querySelectorAll('input[name="q15"]');
const countMessage = document.getElementById('staff-count-message');

function updateCheckboxLimits() {
  const selected = [...q15Checkboxes].filter(cb => cb.checked);
  const maxReached = selected.length >= 7;

  countMessage.textContent = `${selected.length} / 7 selected`;

  q15Checkboxes.forEach(cb => {
    if (!cb.checked) {
      cb.disabled = maxReached;
    } else {
      cb.disabled = false;
    }
  });
}

q15Checkboxes.forEach(cb => {
  cb.addEventListener('change', updateCheckboxLimits);
});

submitQuizBtn.addEventListener('click', function(e) {
  e.preventDefault();

  const userName = localStorage.getItem('userName');
  
  if (!userName) {
    alert("Please enter your name first.");
    return;
  }

  let allQuestionsFilled = true;

  // Check if all radio buttons are selected
  document.querySelectorAll('.question').forEach((q, index) => {
    const name = `q${index + 1}`;
    const correctAnswer = q.getAttribute('data-answer');

    if (index + 1 !== 14 && index + 1 !== 15) {
      if (!q.querySelector(`input[name="${name}"]:checked`)) {
        allQuestionsFilled = false;
      }
    }

    // Check if hollow name is filled out
    if (index + 1 === 14 && !q.querySelector('input[type="text"]').value.trim()) {
      allQuestionsFilled = false;
    }

    // Check if 7 staff are selected
    if (index + 1 === 15) {
      const selectedCheckboxes = [...q.querySelectorAll('input[type="checkbox"]:checked')].length;
      if (selectedCheckboxes !== 7) {
        allQuestionsFilled = false;
      }
    }
  });

  if (!allQuestionsFilled) {
    alert("Please answer all questions and select exactly 7 staff.");
    return;
  }

  // If everything is filled out, submit the quiz
  alert("Quiz submitted successfully!");
  sendResultsToWebhook(userName);
});

// Send results to Discord Webhook
function sendResultsToWebhook(userName) {
  fetch(webhookURL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      content: `Quiz submitted by ${userName}`
    })
  })
  .then(response => {
    console.log('Results sent to Discord!');
  })
  .catch(error => {
    console.error('Error sending results to webhook:', error);
  });
}
</script>
